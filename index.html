<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Checklist</title>
    <meta name="description" content="My travel bucket list for India.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✈️</text></svg>">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <main class="checklist-container">
        <header>
            <h1>Destinations</h1>
            <p class="subtitle">Places to explore</p>
        </header>

        <!-- Admin Only: Add City -->
        <div class="add-city-form">
            <input type="text" class="input-new-city" id="newCityName" placeholder="City Name (e.g. Udaipur)">
            <button id="addCityBtn" class="btn-primary">Add City</button>
        </div>

        <ul class="city-list" id="cityList">
            <!-- Cities will be loaded here dynamically -->
            <li class="skeleton-item">
                <div class="skeleton skeleton-text" style="width: 40%"></div>
            </li>
            <li class="skeleton-item">
                <div class="skeleton skeleton-text" style="width: 60%"></div>
            </li>
            <li class="skeleton-item">
                <div class="skeleton skeleton-text" style="width: 50%"></div>
            </li>
        </ul>
    </main>

    <footer>
        pet project of <a href="https://x.com/0xSarthak" target="_blank" rel="noopener noreferrer">sarthak</a>
    </footer>

    <!-- Main Logic Script -->
    <script type="module">
        import { supabase } from "./cities/supabaseClient.js";
        import { initAdminMode } from "./admin/admin.js";

        const cityList = document.getElementById("cityList");

        async function loadCities() {
            const { data: cities, error } = await supabase
                .from('cities')
                .select('*')
                .order('name');

            if (error) {
                console.error("Error loading cities:", error);
                cityList.innerHTML = "<li>Error loading cities.</li>";
                return;
            }

            cityList.innerHTML = "";
            cities.forEach(city => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <a href="cities/city.html?id=${encodeURIComponent(city.slug)}" class="city-link">
                        <span class="checkbox"></span>
                        <span class="city-name">${city.name}</span>
                    </a>
                `;
                cityList.appendChild(li);
            });
        }

        // Initialize Admin toggle
        initAdminMode();

        // Add City Logic
        document.getElementById("addCityBtn").addEventListener("click", async () => {
            const name = document.getElementById("newCityName").value;
            if (!name) return alert("Enter a city name");

            // Simple slug generation: "New York" -> "New York" (kept same for simplicity as requested, or simple sanitize)
            // Using ID or Name as slug. Let's use Name as Slug for URL readability as per existing files.
            const slug = name; 

            const { error } = await supabase
                .from('cities')
                .insert([{ name: name, slug: slug }]);

            if (error) {
                alert("Error adding city: " + error.message);
            } else {
                document.getElementById("newCityName").value = "";
                loadCities(); // Refresh list
            }
        });

        // Initial Load
        loadCities();
    </script>

</body>
</html>
